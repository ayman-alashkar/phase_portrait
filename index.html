<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Phase Portraits ‚Äî Interactive Guide to Planar Systems</title>
    <!-- SEO -->
    <meta name="description" content="Interactive educational tool for visualizing phase portraits of 2√ó2 linear ODE systems. Explore nodes, saddles, foci, and centers with real-time simulations and step-by-step mathematical explanations."/>
    <meta name="keywords" content="phase portrait, ODE, dynamical systems, eigenvalues, eigenvectors, linear systems, differential equations, planar systems, stability, node, saddle, focus, center, interactive visualization, mathematics education"/>
    <meta name="author" content="Ayman Alashkar"/>
    <link rel="canonical" href="https://ayman-alashkar.github.io/phase_portrait/"/>
    <!-- Open Graph -->
    <meta property="og:title" content="Phase Portraits ‚Äî Interactive Guide to Planar Systems"/>
    <meta property="og:description" content="Explore phase portraits of 2√ó2 linear ODE systems interactively. Visualize nodes, saddles, foci, and centers with real-time simulations."/>
    <meta property="og:url" content="https://ayman-alashkar.github.io/phase_portrait/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Phase Portraits ‚Äî Interactive Guide to Planar Systems"/>
    <meta name="twitter:description" content="Interactive visualization tool for 2√ó2 linear ODE phase portraits. Built for ODE courses."/>
    <!-- Structured Data -->
    <meta name="robots" content="index, follow"/>
    <script type="application/ld+json">{
      "@context":"https://schema.org","@type":"WebApplication",
      "name":"Phase Portraits ‚Äî Interactive Guide to Planar Systems",
      "description":"Interactive educational tool for visualizing phase portraits of 2√ó2 linear ODE systems. Explore nodes, saddles, foci, and centers with real-time simulations.",
      "url":"https://ayman-alashkar.github.io/phase_portrait/",
      "applicationCategory":"EducationalApplication",
      "author":{"@type":"Person","name":"Ayman Alashkar","email":"a.alashkar@oist.jp","affiliation":{"@type":"Organization","name":"Okinawa Institute of Science and Technology (OIST)","url":"https://www.oist.jp"}},
      "educationalLevel":"University","inLanguage":"en",
      "keywords":"phase portrait, ODE, dynamical systems, eigenvalues, linear systems, planar systems, interactive visualization"
    }</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,500;0,9..144,700;1,9..144,400&family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
    :root{
      --bg:#0c0f1a;--surface:#141827;--card:#1a1f33;--card2:#1f2540;
      --border:rgba(255,255,255,.06);--border2:rgba(255,255,255,.1);
      --txt:#e4e8f7;--txt2:#a0a8c8;--txt3:#6b7394;
      --blue:#4d8eff;--cyan:#22d3ee;--purple:#a78bfa;--green:#34d399;
      --red:#f87171;--amber:#fbbf24;--pink:#f472b6;
      --glow:rgba(77,142,255,.15);
      --radius:12px;--radius2:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    html{scroll-behavior:smooth;}
body{
  font-family:'Outfit',sans-serif;background:var(--bg);color:var(--txt);
  line-height:1.6;-webkit-font-smoothing:antialiased;
  display:flex;flex-direction:column;min-height:100vh;
}
/* ===== TOP BAR ===== */
.topbar{
  position:sticky;top:0;z-index:100;
  background:rgba(12,15,26,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.topbar-inner{
  max-width:1680px;margin:0 auto;padding:0 20px;
  display:flex;align-items:center;justify-content:space-between;height:52px;
}
.brand{display:flex;align-items:center;gap:10px;}
.brand-icon{
  width:32px;height:32px;border-radius:8px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:700;color:#fff;
}
.brand h1{font-family:'Fraunces',serif;font-size:1.05rem;font-weight:500;letter-spacing:-.02em;}
.brand-sub{font-size:.7rem;color:var(--txt3);margin-left:12px;}
@media(max-width:600px){.brand-sub{display:none;}}
/* ===== TABS ===== */
.tab-strip{
  max-width:1680px;margin:0 auto;padding:0 20px;
  display:flex;gap:2px;overflow-x:auto;scrollbar-width:none;
}
.tab-strip::-webkit-scrollbar{display:none;}
.tab-btn{
  padding:10px 16px;font-size:.8rem;font-weight:500;
  color:var(--txt3);background:transparent;border:none;cursor:pointer;
  white-space:nowrap;border-bottom:2px solid transparent;
  transition:all .2s;font-family:inherit;position:relative;
}
.tab-btn:hover{color:var(--txt2);}
.tab-btn.active{color:var(--cyan);border-bottom-color:var(--cyan);}
.tab-btn.active::after{
  content:'';position:absolute;bottom:-1px;left:20%;right:20%;height:1px;
  background:var(--cyan);filter:blur(4px);
}
/* ===== TAB CONTENT ===== */
.tab-pane{display:none;}
.tab-pane.active{display:block;animation:fadeUp .3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
/* ===== LAYOUT ===== */
.split{
  max-width:1680px;margin:0 auto;padding:16px 20px 40px;
  display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1.3fr);gap:24px;
  align-items:start;
}
@media(min-width:1600px){.split{grid-template-columns:minmax(0,1fr) minmax(0,1.5fr);gap:32px;}}
@media(max-width:1024px){.split{grid-template-columns:1fr;gap:16px;padding:12px 14px 40px;}}
.full-page{max-width:900px;margin:0 auto;padding:24px 20px 60px;}
/* ===== THEORY SIDE ===== */
.theory{display:flex;flex-direction:column;gap:0;}
.theory h2{font-family:'Fraunces',serif;font-size:1.6rem;font-weight:500;letter-spacing:-.03em;margin-bottom:12px;line-height:1.25;}
.theory h3{font-family:'Fraunces',serif;font-size:1.1rem;font-weight:500;color:var(--cyan);margin:20px 0 8px;letter-spacing:-.01em;}
.theory h4{font-size:.85rem;font-weight:600;margin:14px 0 6px;color:var(--purple);}
.theory p{font-size:.88rem;color:var(--txt2);margin-bottom:10px;line-height:1.7;}
.theory ul{margin:6px 0 10px 18px;font-size:.85rem;color:var(--txt2);line-height:1.8;}
/* ===== VIZ SIDE ===== */
.viz{display:flex;flex-direction:column;gap:12px;}
@media(min-width:1025px){.viz{position:sticky;top:68px;}}
/* ===== MATH BLOCKS ===== */
.math-block{
  margin:10px 0;padding:14px 18px;border-radius:var(--radius);
  background:linear-gradient(135deg,rgba(77,142,255,.06),rgba(167,139,250,.06));
  border-left:3px solid var(--blue);
  font-family:'Fraunces',serif;font-style:italic;font-size:1rem;
  line-height:1.9;color:var(--txt);overflow-x:auto;
}
.math-block .tag{
  font-family:'Outfit',sans-serif;font-style:normal;font-weight:600;
  font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;
  color:var(--blue);display:block;margin-bottom:4px;
}
.mi{font-family:'Fraunces',serif;font-style:italic;white-space:nowrap;}
code,.mono{font-family:'JetBrains Mono',monospace;font-size:.82em;background:rgba(255,255,255,.05);padding:1px 5px;border-radius:4px;}
/* ===== CARDS ===== */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius2);overflow:hidden;}
.card-head{
  padding:10px 14px;display:flex;align-items:center;justify-content:space-between;
  border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;
}
.card-head .badge{font-size:.7rem;font-weight:600;padding:3px 10px;border-radius:999px;background:rgba(34,211,238,.1);color:var(--cyan);}
/* ===== CALLOUTS ===== */
.callout{margin:12px 0;padding:12px 16px;border-radius:var(--radius);font-size:.85rem;line-height:1.65;}
.callout strong{font-weight:600;}
.callout-blue{background:rgba(77,142,255,.08);border:1px solid rgba(77,142,255,.15);color:var(--txt);}
.callout-green{background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.15);color:var(--txt);}
.callout-amber{background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.15);color:var(--txt);}
.callout-purple{background:rgba(167,139,250,.08);border:1px solid rgba(167,139,250,.15);color:var(--txt);}
.callout .icon{margin-right:6px;}
/* ===== SUB-CASES ===== */
.subcase{margin:8px 0;padding:12px 16px;border-radius:var(--radius);background:var(--card2);border:1px solid var(--border);}
.subcase-title{font-size:.85rem;font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:8px;}
.subcase p{font-size:.82rem;margin-bottom:4px;}
.badge-s{padding:2px 8px;border-radius:999px;font-size:.68rem;font-weight:700;}
.badge-stable{background:rgba(52,211,153,.15);color:var(--green);}
.badge-unstable{background:rgba(248,113,113,.15);color:var(--red);}
.badge-neutral{background:rgba(251,191,36,.15);color:var(--amber);}
/* ===== MATRIX ===== */
.mtx{
  display:inline-grid;grid-template-columns:auto auto;gap:1px 14px;
  padding:6px 14px;margin:2px 6px;vertical-align:middle;
  border-left:2px solid var(--txt);border-right:2px solid var(--txt);
  font-family:'Fraunces',serif;font-size:.95rem;
}
/* ===== CANVAS ===== */
canvas{display:block;width:100%;}
/* ===== CONTROLS ===== */
.ctrl-bar{padding:8px 14px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;border-top:1px solid var(--border);font-size:.78rem;}
.ctrl{display:flex;align-items:center;gap:5px;}
.ctrl label{color:var(--txt3);font-weight:500;white-space:nowrap;}
.ctrl input[type="range"]{width:90px;accent-color:var(--cyan);height:4px;}
.ctrl .v{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--cyan);min-width:32px;}
.btn{
  padding:5px 12px;border-radius:8px;font-size:.78rem;font-weight:600;
  border:1px solid var(--border2);background:var(--card2);color:var(--txt);
  cursor:pointer;font-family:inherit;transition:all .15s;
}
.btn:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.15);}
.btn-primary{background:rgba(77,142,255,.15);border-color:rgba(77,142,255,.3);color:var(--blue);}
.btn-primary:hover{background:rgba(77,142,255,.25);}
.btn-danger{background:rgba(248,113,113,.1);border-color:rgba(248,113,113,.25);color:var(--red);}
/* ===== PILLS ===== */
.pills{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0;}
.pill{
  padding:5px 12px;border-radius:999px;font-size:.75rem;font-weight:600;
  border:1px solid var(--border2);background:transparent;color:var(--txt2);
  cursor:pointer;transition:all .2s;font-family:inherit;
}
.pill:hover{border-color:var(--cyan);color:var(--cyan);}
.pill.on{background:rgba(34,211,238,.12);border-color:rgba(34,211,238,.4);color:var(--cyan);}
/* ===== TIME BAR ===== */
.time-bar{padding:6px 14px;border-top:1px solid var(--border);}
.time-bar input[type="range"]{width:100%;accent-color:var(--amber);height:4px;}
/* ===== LEGEND ===== */
.legend{display:flex;gap:12px;font-size:.72rem;color:var(--txt3);}
.legend-item{display:flex;align-items:center;gap:4px;}
.swatch{width:12px;height:3px;border-radius:2px;}
.ts-legend{display:flex;gap:12px;font-size:.72rem;color:var(--txt3);padding:0;}
/* ===== EIGBOX ===== */
.eigbox{margin:10px 0;padding:10px 14px;border-radius:var(--radius);background:var(--card2);border:1px solid var(--border);}
.kv{display:flex;justify-content:space-between;gap:8px;font-size:.78rem;color:var(--txt3);padding:3px 0;}
.kv b{color:var(--txt);font-weight:600;text-align:right;font-family:'JetBrains Mono',monospace;font-size:.78rem;}
.kv-sep{border:none;border-top:1px solid var(--border);margin:4px 0;}
/* ===== STEP LIST ===== */
.steps{counter-reset:s;margin:12px 0;}
.step{
  counter-increment:s;padding:8px 12px 8px 44px;position:relative;
  border-left:2px solid var(--border);margin-left:14px;margin-bottom:4px;
}
.step::before{
  content:counter(s);position:absolute;left:-14px;top:8px;
  width:24px;height:24px;border-radius:50%;
  background:linear-gradient(135deg,var(--blue),var(--purple));color:#fff;
  display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;
}
.step:last-child{border-left-color:transparent;}
.step h4{margin-top:0;}
/* ===== TABLE ===== */
.tbl{width:100%;border-collapse:collapse;font-size:.82rem;margin:12px 0;}
.tbl th{padding:8px 10px;text-align:left;border-bottom:2px solid var(--border2);color:var(--txt3);font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;}
.tbl td{padding:8px 10px;border-bottom:1px solid var(--border);color:var(--txt2);}
.tbl tr:hover td{background:rgba(255,255,255,.02);}
/* ===== NUMBER INPUTS ===== */
input[type="number"]{
  width:68px;padding:6px 8px;border-radius:8px;
  border:1px solid var(--border2);background:var(--surface);
  color:var(--txt);font-family:'JetBrains Mono',monospace;font-size:.85rem;outline:none;
}
input[type="number"]:focus{border-color:var(--blue);box-shadow:0 0 0 3px var(--glow);}
.grid2x2{display:grid;grid-template-columns:1fr 1fr;gap:6px;max-width:160px;}
/* ===== FOOTER ===== */
.site-footer{
  margin-top:auto;border-top:1px solid var(--border);
  padding:20px;text-align:center;font-size:.75rem;color:var(--txt3);
}
.site-footer a{color:var(--cyan);text-decoration:none;}
.site-footer a:hover{text-decoration:underline;}
.footer-row{display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;}
.footer-dot{opacity:.4;}
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-inner">
    <div style="display:flex;align-items:center;gap:16px;">
      <div class="brand">
        <div class="brand-icon">PP</div>
        <h1>Phase Portraits</h1>
      </div>
      <span class="brand-sub">Planar Systems</span>
    </div>
    <span style="font-size:.7rem;color:var(--txt3);">ODEs</span>
  </div>
  <div class="tab-strip" id="tabBar"></div>
</div>

<main id="tabContainer" style="flex:1;">
<!-- Pre-rendered Overview for SEO ‚Äî JS will manage tabs dynamically -->
<div id="tab-overview" class="tab-pane active">
  <div class="full-page">
    <h2 style="font-family:'Fraunces',serif;font-size:2rem;font-weight:500;margin-bottom:6px;">What Is a Phase Portrait?</h2>
    <p style="color:var(--txt2);font-size:.9rem;margin-bottom:20px;">A visual map showing how <em>all</em> solutions of a 2D system behave at once.</p>
    <div class="math-block"><span class="tag">The System</span>
      <strong>x</strong>‚Ä≤ = <strong>A</strong><strong>x</strong> &nbsp;‚üπ&nbsp; x(t) = e<sup>tA</sup>x‚ÇÄ</div>
    <p>As time evolves, the point (x‚ÇÅ(t), x‚ÇÇ(t)) traces a curve in the plane. A <strong>phase portrait</strong> collects these curves for many initial conditions, revealing the qualitative dynamics at a glance.</p>
    <div class="callout callout-blue"><span class="icon">üí°</span> Every 2√ó2 matrix A is similar to one of three canonical forms. The <strong>eigenvalues</strong> determine the type. The <strong>eigenvectors</strong> determine the skew.</div>
    <h3 style="font-family:'Fraunces',serif;font-size:1.2rem;color:var(--cyan);margin:24px 0 12px;">The Three Canonical Forms</h3>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-stable">CASE 1</span> Diagonalizable ‚Äî real eigenvalues</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>0</span><span>0</span><span>Œ≤</span></span> ‚Üí x‚ÇÅ = c‚ÇÅe<sup>Œ±t</sup>, x‚ÇÇ = c‚ÇÇe<sup>Œ≤t</sup></div>
      <p>‚Üí <strong>Nodes</strong> (same sign) or <strong>Saddles</strong> (opposite sign)</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-neutral">CASE 2</span> Defective ‚Äî repeated eigenvalue</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>1</span><span>0</span><span>Œ±</span></span> ‚Üí x‚ÇÅ = (c‚ÇÅ+c‚ÇÇt)e<sup>Œ±t</sup>, x‚ÇÇ = c‚ÇÇe<sup>Œ±t</sup></div>
      <p>‚Üí <strong>Improper nodes</strong> with fan-shaped trajectories</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">CASE 3</span> Complex conjugate eigenvalues Œ± ¬± Œ≤i</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>‚àíŒ≤</span><span>Œ≤</span><span>Œ±</span></span> ‚Üí x(t) = e<sup>Œ±t</sup>(cos Œ≤t, sin Œ≤t)</div>
      <p>‚Üí <strong>Foci</strong> (spirals) or <strong>Centers</strong> (closed orbits)</p></div>
    <h3 style="font-family:'Fraunces',serif;font-size:1.2rem;color:var(--cyan);margin:24px 0 12px;">Classification Summary</h3>
    <table class="tbl"><tr><th>Eigenvalues</th><th>Portrait Type</th><th>Stability</th></tr>
      <tr><td>Œª‚ÇÅ, Œª‚ÇÇ real, same sign</td><td>Node</td><td>Stable if both &lt; 0</td></tr>
      <tr><td>Œª‚ÇÅ, Œª‚ÇÇ real, opposite</td><td>Saddle</td><td>Always unstable</td></tr>
      <tr><td>Œª repeated (defective)</td><td>Improper node</td><td>Stable if Œ± &lt; 0</td></tr>
      <tr><td>Œ± ¬± Œ≤i, Œ± ‚â† 0</td><td>Focus (spiral)</td><td>Stable if Œ± &lt; 0</td></tr>
      <tr><td>¬± Œ≤i (pure imag.)</td><td>Center</td><td>Stable (not asymp.)</td></tr></table>
    <div class="callout callout-purple"><span class="icon">üîë</span> <strong>Key insight:</strong> trace = Œª‚ÇÅ+Œª‚ÇÇ, det = Œª‚ÇÅŒª‚ÇÇ, discriminant Œî = tr¬≤‚àí4det. These three numbers classify everything.</div>

    <!-- SEO-only extended content: visible to crawlers, provides keyword-rich text -->
    <section style="margin-top:32px;">
      <h3 style="font-family:'Fraunces',serif;font-size:1.2rem;color:var(--cyan);margin:24px 0 12px;">About This Interactive Tool</h3>
      <p>This interactive educational tool lets you explore phase portraits of 2√ó2 linear ordinary differential equation (ODE) systems of the form <strong>x‚Ä≤ = Ax</strong>. It covers all classification cases for planar linear systems: stable and unstable nodes, saddle points, star nodes, improper nodes (defective matrices), stable and unstable foci (spirals), and centers (pure imaginary eigenvalues producing closed orbits).</p>
      <p>Each case includes step-by-step mathematical derivations, canonical forms, matrix exponentials, and real-time interactive simulations powered by 4th-order Runge-Kutta integration. Use the tabs above to navigate between the three canonical eigenvalue cases, worked textbook examples, and a free explorer where you can enter any 2√ó2 matrix and see its phase portrait, eigenvalue analysis, and trace-determinant classification diagram.</p>
      <p>Topics covered: eigenvalues and eigenvectors of 2√ó2 matrices, diagonalization, Jordan normal form, matrix exponentials, stability analysis, trace-determinant plane, separatrices, power-law trajectory equations, and the role of the discriminant Œî = tr¬≤ ‚àí 4det in classifying equilibrium points of linear dynamical systems.</p>
      <p>Built for ODE courses at the university level. Free, open-source, and runs entirely in the browser with no installation required.</p>
    </section>
  </div>
</div>
</main>

<noscript>
  <div style="max-width:800px;margin:40px auto;padding:20px;color:#e4e8f7;font-family:sans-serif;">
    <h2>Phase Portraits ‚Äî Interactive Guide to Planar Systems</h2>
    <p>This interactive tool requires JavaScript to run the phase portrait simulations. Please enable JavaScript in your browser to use the interactive visualizations.</p>
    <p>This tool covers phase portraits of 2√ó2 linear ODE systems x‚Ä≤ = Ax, including: stable and unstable nodes, saddle points, improper nodes, spiral foci, and centers. It features real-time RK4 integration, eigenvalue analysis, trace-determinant classification diagrams, and step-by-step worked examples.</p>
    <p>Created by Ayman Alashkar at the Okinawa Institute of Science and Technology (OIST). Contact: a.alashkar@oist.jp</p>
  </div>
</noscript>

<footer class="site-footer">
  <div class="footer-row">
    <span>¬© 2026 <strong>Ayman Alashkar</strong></span>
    <span class="footer-dot">¬∑</span>
    <a href="https://www.oist.jp" target="_blank" rel="noopener">Okinawa Institute of Science and Technology (OIST)</a>
    <span class="footer-dot">¬∑</span>
    <a href="mailto:a.alashkar@oist.jp">a.alashkar@oist.jp</a>
  </div>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CORE ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EPS=1e-9,clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
const fmt=x=>{if(!isFinite(x))return"‚àû";const a=Math.abs(x);if(a>=1000)return x.toExponential(1);if(a>0&&a<1e-3)return x.toExponential(1);return Number(x.toFixed(3)).toString();};
const cfmt=(r,i)=>{if(Math.abs(i)<1e-8)return fmt(r);return`${fmt(r)} ${i>=0?"+":"‚àí"} ${fmt(Math.abs(i))}i`;};
function mulAx(A,x){return[A[0][0]*x[0]+A[0][1]*x[1],A[1][0]*x[0]+A[1][1]*x[1]];}
function rk4(A,x,dt){
  const k1=mulAx(A,x),x2=[x[0]+.5*dt*k1[0],x[1]+.5*dt*k1[1]],k2=mulAx(A,x2),
    x3=[x[0]+.5*dt*k2[0],x[1]+.5*dt*k2[1]],k3=mulAx(A,x3),
    x4=[x[0]+dt*k3[0],x[1]+dt*k3[1]],k4=mulAx(A,x4);
  return[x[0]+(dt/6)*(k1[0]+2*k2[0]+2*k3[0]+k4[0]),x[1]+(dt/6)*(k1[1]+2*k2[1]+2*k3[1]+k4[1])];
}
function eig2x2(A){
  const a=A[0][0],b=A[0][1],c=A[1][0],d=A[1][1],tr=a+d,det=a*d-b*c,disc=tr*tr-4*det;
  let l1={re:0,im:0},l2={re:0,im:0};
  if(disc>=-1e-12){const s=Math.sqrt(Math.max(0,disc));l1.re=.5*(tr+s);l2.re=.5*(tr-s);}
  else{const s=Math.sqrt(-disc);l1.re=l2.re=.5*tr;l1.im=.5*s;l2.im=-.5*s;}
  const evecs=[];
  if(Math.abs(l1.im)<1e-10){
    for(const lam of[l1.re,l2.re]){
      const m=a-lam,m2=d-lam;let v;
      if(Math.abs(b)>Math.abs(c))v=[b,-m];else if(Math.abs(c)>EPS)v=[-m2,c];
      else if(Math.abs(b)>EPS)v=[b,-m];else v=Math.abs(m)<Math.abs(m2)?[1,0]:[0,1];
      const n=Math.hypot(v[0],v[1])||1;evecs.push([v[0]/n,v[1]/n]);
    }
  }
  return{tr,det,disc,l1,l2,evecs};
}
function classifyKey(eig){
  if(Math.abs(eig.det)<1e-10)return"degenerate";
  if(eig.det<0)return"saddle";
  if(Math.abs(eig.l1.im)>1e-8)return Math.abs(eig.l1.re)<1e-8?"center":eig.l1.re<0?"stable_focus":"unstable_focus";
  if(eig.l1.re<-EPS&&eig.l2.re<-EPS)return"stable_node";
  if(eig.l1.re>EPS&&eig.l2.re>EPS)return"unstable_node";
  return"degenerate";
}
const CLASS_NAMES={center:"Center",stable_focus:"Stable Focus",unstable_focus:"Unstable Focus",stable_node:"Stable Node",unstable_node:"Unstable Node",saddle:"Saddle",degenerate:"Degenerate"};
function integrate(A,x0,dt,steps,range){
  const lim=range*6,fwd=[[x0[0],x0[1]]],bwd=[[x0[0],x0[1]]];
  let x=[...x0];for(let i=0;i<steps;i++){x=rk4(A,x,dt);if(!isFinite(x[0])||Math.hypot(...x)>lim)break;fwd.push([...x]);}
  x=[...x0];for(let i=0;i<steps;i++){x=rk4(A,x,-dt);if(!isFinite(x[0])||Math.hypot(...x)>lim)break;bwd.push([...x]);}
  return{fwd,bwd,tmax:(fwd.length-1)*dt};
}
const TC=["#ef4444","#3b82f6","#a78bfa","#34d399","#fbbf24","#f472b6","#22d3ee","#f97316","#6366f1","#14b8a6","#e879f9","#84cc16"];

function PhaseEngine(cId,tsId,opts={}){
  const C=document.getElementById(cId),T=tsId?document.getElementById(tsId):null;
  if(!C)return null;const cx=C.getContext("2d"),tx=T?T.getContext("2d"):null;
  const S={A:opts.A||[[0,-1],[1,0]],R:opts.range||5,dt:.015,steps:2000,
    traj:[],sel:0,t:0,play:false,spd:opts.speed||.8,field:true,eigen:true,curves:true,
    _playBtn:null};
  const w2c=(x,y)=>[(x/S.R)*(C.width/2)+C.width/2,C.height/2-(y/S.R)*(C.height/2)];
  const c2w=(px,py)=>[((px-C.width/2)/(C.width/2))*S.R,((C.height/2-py)/(C.height/2))*S.R];
  function rsz(c){if(!c)return;const d=devicePixelRatio||1,r=c.getBoundingClientRect(),w=Math.floor(r.width*d),h=Math.floor(r.height*d);if(c.width!==w||c.height!==h){c.width=w;c.height=h;}}
  function setA(A){S.A=A;const old=S.traj.map(t=>({x0:t.x0,col:t.col}));S.traj=[];old.forEach(o=>{const d=integrate(S.A,o.x0,S.dt,S.steps,S.R);S.traj.push({...o,...d});});}
  function clear(){S.traj=[];S.sel=0;S.t=0;S.play=false;_syncBtn();}
  function add(x0,col){const d=integrate(S.A,x0,S.dt,S.steps,S.R);S.traj.push({x0,col:col||TC[S.traj.length%TC.length],...d});S.sel=S.traj.length-1;S.t=0;}
  function seed(pts){clear();pts.forEach((p,i)=>add(p,TC[i%TC.length]));}
  function autoSeed(){
    const eig=eig2x2(S.A),cls=classifyKey(eig),r=S.R*.75;clear();
    if(cls==="saddle"&&eig.evecs.length===2){
      const v1=eig.evecs[0],v2=eig.evecs[1];
      [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(s=>{const d=[s[0]*v1[0]+s[1]*v2[0],s[0]*v1[1]+s[1]*v2[1]];const n=Math.hypot(...d)||1;add([.5*r*d[0]/n,.5*r*d[1]/n]);add([.8*r*d[0]/n,.8*r*d[1]/n]);});
    }else if(cls.includes("node")){
      for(let i=0;i<10;i++){const th=i*Math.PI/5+.15;add([r*.7*Math.cos(th),r*.7*Math.sin(th)]);}
    }else if(cls==="degenerate"){
      const v=eig.evecs[0]||[1,0],p=[-v[1],v[0]];
      [.8,-.6].forEach(f=>add([r*f*v[0],r*f*v[1]]));
      [.7,-.5,.4,-.3].forEach(f=>add([r*.6*(v[0]+f*p[0]),r*.6*(v[1]+f*p[1])]));
      [.5,-.4].forEach(f=>add([r*f*p[0],r*f*p[1]]));
    }else{[.3,.55,.85].forEach((f,i)=>{const th=i*.55;add([r*f*Math.cos(th),r*f*Math.sin(th)]);});}
  }
  function _syncBtn(){if(S._playBtn)S._playBtn.textContent=S.play?"‚è∏ Pause":"‚ñ∂ Play";}
  function drawPhase(){
    rsz(C);const w=C.width,h=C.height,d=devicePixelRatio||1,r=S.R;
    cx.clearRect(0,0,w,h);
    const bg=cx.createRadialGradient(w/2,h/2,0,w/2,h/2,w*.7);
    bg.addColorStop(0,"#151b30");bg.addColorStop(1,"#0c0f1a");
    cx.fillStyle=bg;cx.fillRect(0,0,w,h);
    const gs=r<=4?1:r<=8?2:5;cx.strokeStyle="rgba(255,255,255,.04)";cx.lineWidth=1;
    for(let x=-r;x<=r;x+=gs){const[a,b]=w2c(x,-r),[c,e]=w2c(x,r);cx.beginPath();cx.moveTo(a,b);cx.lineTo(c,e);cx.stroke();}
    for(let y=-r;y<=r;y+=gs){const[a,b]=w2c(-r,y),[c,e]=w2c(r,y);cx.beginPath();cx.moveTo(a,b);cx.lineTo(c,e);cx.stroke();}
    cx.strokeStyle="rgba(255,255,255,.15)";cx.lineWidth=1;
    let p=w2c(-r,0),q=w2c(r,0);cx.beginPath();cx.moveTo(p[0],p[1]);cx.lineTo(q[0],q[1]);cx.stroke();
    p=w2c(0,-r);q=w2c(0,r);cx.beginPath();cx.moveTo(p[0],p[1]);cx.lineTo(q[0],q[1]);cx.stroke();
    cx.fillStyle="rgba(255,255,255,.35)";cx.font=`500 ${11*d}px Outfit`;
    let[lx,ly]=w2c(r*.92,.3);cx.fillText("x‚ÇÅ",lx,ly);[lx,ly]=w2c(.2,r*.92);cx.fillText("x‚ÇÇ",lx,ly);
    if(S.field){const gn=11;for(let i=0;i<gn;i++)for(let j=0;j<gn;j++){
      const x=-r+(2*r)*(i/(gn-1)),y=-r+(2*r)*(j/(gn-1));
      const v=mulAx(S.A,[x,y]),sp=Math.hypot(...v);if(sp<1e-5)continue;
      const u=[v[0]/sp,v[1]/sp],ln=r*.05*(.5+.5*Math.tanh(sp/2));
      const p1=w2c(x,y),p2=w2c(x+u[0]*ln,y+u[1]*ln);
      cx.strokeStyle="rgba(77,142,255,.08)";cx.lineWidth=1;
      cx.beginPath();cx.moveTo(p1[0],p1[1]);cx.lineTo(p2[0],p2[1]);cx.stroke();
      const an=Math.atan2(p2[1]-p1[1],p2[0]-p1[0]),ah=4*d;
      cx.fillStyle="rgba(77,142,255,.08)";cx.beginPath();cx.moveTo(p2[0],p2[1]);
      cx.lineTo(p2[0]-ah*Math.cos(an-.5),p2[1]-ah*Math.sin(an-.5));
      cx.lineTo(p2[0]-ah*Math.cos(an+.5),p2[1]-ah*Math.sin(an+.5));cx.closePath();cx.fill();
    }}
    if(S.eigen){const eig=eig2x2(S.A),cls=classifyKey(eig);
      eig.evecs.forEach((v,k)=>{
        cx.save();cx.lineWidth=1.5;cx.setLineDash([6,5]);
        cx.strokeStyle=cls==="saddle"?(k===0?eig.l1.re:eig.l2.re)>0?"rgba(248,113,113,.35)":"rgba(52,211,153,.35)":"rgba(167,139,250,.25)";
        const a=w2c(-r*1.3*v[0],-r*1.3*v[1]),b=w2c(r*1.3*v[0],r*1.3*v[1]);
        cx.beginPath();cx.moveTo(a[0],a[1]);cx.lineTo(b[0],b[1]);cx.stroke();cx.setLineDash([]);cx.restore();
      });
    }
    const[ox,oy]=w2c(0,0);cx.fillStyle="rgba(255,255,255,.7)";cx.beginPath();cx.arc(ox,oy,2.5*d,0,Math.PI*2);cx.fill();
    if(S.curves)S.traj.forEach((tr,ti)=>{
      const is=ti===S.sel;cx.save();cx.lineWidth=is?2.2:1.2;
      cx.strokeStyle=is?tr.col:(tr.col+"66");cx.globalAlpha=is?1:.5;
      cx.beginPath();let st=false;
      for(let i=tr.bwd.length-1;i>=0;i--){const pt=w2c(...tr.bwd[i]);st?cx.lineTo(...pt):(cx.moveTo(...pt),st=true);}
      for(let i=1;i<tr.fwd.length;i++){const pt=w2c(...tr.fwd[i]);cx.lineTo(...pt);}
      cx.stroke();cx.restore();
    });
    S.traj.forEach((tr,ti)=>{
      const is=ti===S.sel,idx=Math.min(tr.fwd.length-1,Math.max(0,Math.floor(S.t/S.dt))),pt=tr.fwd[idx];if(!pt)return;
      cx.save();const tail=50,st=Math.max(0,idx-tail);
      for(let i=st+1;i<=idx;i++){const p1=tr.fwd[i-1],p2=tr.fwd[i];if(!p1||!p2)continue;
        cx.globalAlpha=(is?.7:.4)*((i-st)/(idx-st||1));cx.strokeStyle=tr.col;cx.lineWidth=is?2.5:1.8;
        const c1=w2c(...p1),c2=w2c(...p2);cx.beginPath();cx.moveTo(...c1);cx.lineTo(...c2);cx.stroke();}
      cx.restore();
      const[px,py]=w2c(...pt);cx.save();
      const rd=12*d,g=cx.createRadialGradient(px,py,0,px,py,rd);
      g.addColorStop(0,tr.col+"88");g.addColorStop(1,"transparent");
      cx.fillStyle=g;cx.beginPath();cx.arc(px,py,rd,0,Math.PI*2);cx.fill();
      cx.fillStyle="#fff";cx.beginPath();cx.arc(px,py,3.5*d,0,Math.PI*2);cx.fill();
      cx.fillStyle=tr.col;cx.beginPath();cx.arc(px,py,2.2*d,0,Math.PI*2);cx.fill();
      if(is){cx.strokeStyle=tr.col;cx.lineWidth=1.5*d;cx.beginPath();cx.arc(px,py,5.5*d,0,Math.PI*2);cx.stroke();}
      cx.restore();
    });
  }
  function drawTS(){
    if(!T||!tx)return;rsz(T);const w=T.width,h=T.height,d=devicePixelRatio||1;
    tx.clearRect(0,0,w,h);tx.fillStyle="#0f1320";tx.fillRect(0,0,w,h);
    const sel=S.traj[S.sel];if(!sel||sel.fwd.length<2){
      tx.fillStyle="rgba(255,255,255,.25)";tx.font=`${11*d}px Outfit`;
      tx.fillText("Click the phase plane to add trajectories",10*d,h/2);return;}
    const n=sel.fwd.length,tm=sel.tmax;let mx=1;
    for(let i=0;i<n;i++){const p=sel.fwd[i];mx=Math.max(mx,Math.abs(p[0]),Math.abs(p[1]));}
    const pl=6*d,pr=6*d,pt=6*d,pb=6*d,pw=w-pl-pr,ph=h-pt-pb;
    const xP=t=>pl+(t/tm)*pw,yP=v=>pt+(.5-.5*(v/mx))*ph;
    tx.strokeStyle="rgba(255,255,255,.06)";tx.lineWidth=1;
    tx.beginPath();tx.moveTo(pl,yP(0));tx.lineTo(pl+pw,yP(0));tx.stroke();
    tx.strokeStyle="#3b82f6";tx.lineWidth=1.8;tx.beginPath();
    for(let i=0;i<n;i++){const p=sel.fwd[i];i===0?tx.moveTo(xP(i*S.dt),yP(p[0])):tx.lineTo(xP(i*S.dt),yP(p[0]));}tx.stroke();
    tx.strokeStyle="#a78bfa";tx.lineWidth=1.8;tx.beginPath();
    for(let i=0;i<n;i++){const p=sel.fwd[i];i===0?tx.moveTo(xP(i*S.dt),yP(p[1])):tx.lineTo(xP(i*S.dt),yP(p[1]));}tx.stroke();
    tx.strokeStyle="rgba(251,191,36,.7)";tx.lineWidth=1.2;
    const cx2=xP(clamp(S.t,0,tm));tx.beginPath();tx.moveTo(cx2,pt);tx.lineTo(cx2,pt+ph);tx.stroke();
  }
  C.addEventListener("pointerdown",e=>{
    const r=C.getBoundingClientRect(),d=devicePixelRatio||1;
    const[x,y]=c2w((e.clientX-r.left)*d,(e.clientY-r.top)*d);
    let best=-1,bd=Infinity;
    S.traj.forEach((tr,i)=>{for(let j=0;j<tr.fwd.length;j+=8){const p=tr.fwd[j],dd=(p[0]-x)**2+(p[1]-y)**2;if(dd<bd){bd=dd;best=i;}}});
    if(bd<(S.R*.13)**2&&best>=0){S.sel=best;S.t=0;S.play=false;_syncBtn();return;}
    add([x,y]);
  });
  let af=null,lt=0;
  function tick(now){const dt=(now-lt)/1000;lt=now;
    if(S.play){const sel=S.traj[S.sel];if(sel){S.t+=dt*S.spd;if(S.t>=sel.tmax){S.t=sel.tmax;S.play=false;_syncBtn();}}}
    drawPhase();drawTS();af=requestAnimationFrame(tick);}
  function start(){if(!af){lt=performance.now();af=requestAnimationFrame(tick);}}
  function stop(){if(af){cancelAnimationFrame(af);af=null;}}
  return{S,setA,clear,add,seed,autoSeed,start,stop,drawPhase,drawTS};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TAB SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TABS=[
  {id:"overview",label:"Overview"},
  {id:"case1",label:"Case 1 ¬∑ Real Œª"},
  {id:"case2",label:"Case 2 ¬∑ Repeated Œª"},
  {id:"case3",label:"Case 3 ¬∑ Complex Œª"},
  {id:"examples",label:"Examples"},
  {id:"explorer",label:"Explorer"},
];
const built={},engines={};
function initTabs(){
  const bar=document.getElementById("tabBar"),cont=document.getElementById("tabContainer");
  TABS.forEach((t,i)=>{
    const b=document.createElement("button");b.className="tab-btn"+(i===0?" active":"");b.textContent=t.label;
    b.onclick=()=>{
      document.querySelectorAll(".tab-btn").forEach(x=>x.classList.remove("active"));b.classList.add("active");
      document.querySelectorAll(".tab-pane").forEach(x=>x.classList.remove("active"));
      document.getElementById("tab-"+t.id).classList.add("active");
      if(!built[t.id]){builders[t.id]();built[t.id]=true;}
      Object.values(engines).forEach(e=>e?.start());
    };
    bar.appendChild(b);
    // Only create tab pane if not pre-rendered
    if(!document.getElementById("tab-"+t.id)){
      const d=document.createElement("div");d.id="tab-"+t.id;d.className="tab-pane";cont.appendChild(d);
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPER: wire up play/rewind/time for an engine
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function wireControls(eng,playId,rewId,timeId,speedId,clearId){
  const pb=document.getElementById(playId),rb=document.getElementById(rewId),
    ts=document.getElementById(timeId),sp=speedId?document.getElementById(speedId):null,
    cl=clearId?document.getElementById(clearId):null;
  // Register play button on engine so auto-stop can update it
  if(pb)eng.S._playBtn=pb;
  if(pb)pb.onclick=()=>{const s=eng.S.traj[eng.S.sel];if(!s)return;
    // If at end, rewind first
    if(!eng.S.play&&eng.S.t>=s.tmax-.01){eng.S.t=0;if(ts)ts.value=0;}
    eng.S.play=!eng.S.play;pb.textContent=eng.S.play?"‚è∏ Pause":"‚ñ∂ Play";};
  if(rb)rb.onclick=()=>{eng.S.t=0;if(ts)ts.value=0;eng.S.play=false;if(pb)pb.textContent="‚ñ∂ Play";};
  if(ts){ts.addEventListener("pointerdown",()=>{eng.S.play=false;if(pb)pb.textContent="‚ñ∂ Play";});
    ts.addEventListener("input",()=>{eng.S.t=+ts.value;eng.S.play=false;if(pb)pb.textContent="‚ñ∂ Play";});}
  if(sp)sp.oninput=()=>{eng.S.spd=+sp.value;};
  if(cl)cl.onclick=()=>{eng.clear();};
  // Sync loop ‚Äî ALWAYS syncs slider & button, not just when playing
  (function sync(){
    if(ts)ts.value=eng.S.t;
    // Keep button in sync (e.g. after auto-stop at end)
    if(pb){const label=eng.S.play?"‚è∏ Pause":"‚ñ∂ Play";if(pb.textContent!==label)pb.textContent=label;}
    requestAnimationFrame(sync);
  })();
}

// Helper: standard TS legend HTML
const TS_LEGEND='<div class="ts-legend"><div class="legend-item"><div class="swatch" style="background:#3b82f6"></div>x‚ÇÅ(t)</div><div class="legend-item"><div class="swatch" style="background:#a78bfa"></div>x‚ÇÇ(t)</div></div>';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const builders={};

builders.overview=()=>{
  document.getElementById("tab-overview").innerHTML=`
  <div class="full-page">
    <h2 style="font-family:'Fraunces',serif;font-size:2rem;font-weight:500;margin-bottom:6px;">What Is a Phase Portrait?</h2>
    <p style="color:var(--txt2);font-size:.9rem;margin-bottom:20px;">A visual map showing how <em>all</em> solutions of a 2D system behave at once.</p>
    <div class="math-block"><span class="tag">The System</span>
      <strong>x</strong>‚Ä≤ = <strong>A</strong><strong>x</strong> &nbsp;‚üπ&nbsp; x(t) = e<sup>tA</sup>x‚ÇÄ</div>
    <p>As time evolves, the point (x‚ÇÅ(t), x‚ÇÇ(t)) traces a curve in the plane. A <strong>phase portrait</strong> collects these curves for many initial conditions, revealing the qualitative dynamics at a glance.</p>
    <div class="callout callout-blue"><span class="icon">üí°</span> Every 2√ó2 matrix A is similar to one of three canonical forms. The <strong>eigenvalues</strong> determine the type. The <strong>eigenvectors</strong> determine the skew.</div>
    <h3 style="font-family:'Fraunces',serif;font-size:1.2rem;color:var(--cyan);margin:24px 0 12px;">The Three Canonical Forms</h3>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-stable">CASE 1</span> Diagonalizable ‚Äî real eigenvalues</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>0</span><span>0</span><span>Œ≤</span></span> ‚Üí x‚ÇÅ = c‚ÇÅe<sup>Œ±t</sup>, x‚ÇÇ = c‚ÇÇe<sup>Œ≤t</sup></div>
      <p>‚Üí <strong>Nodes</strong> (same sign) or <strong>Saddles</strong> (opposite sign)</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-neutral">CASE 2</span> Defective ‚Äî repeated eigenvalue</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>1</span><span>0</span><span>Œ±</span></span> ‚Üí x‚ÇÅ = (c‚ÇÅ+c‚ÇÇt)e<sup>Œ±t</sup>, x‚ÇÇ = c‚ÇÇe<sup>Œ±t</sup></div>
      <p>‚Üí <strong>Improper nodes</strong> with fan-shaped trajectories</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">CASE 3</span> Complex conjugate eigenvalues Œ± ¬± Œ≤i</div>
      <div class="math-block">M = <span class="mtx"><span>Œ±</span><span>‚àíŒ≤</span><span>Œ≤</span><span>Œ±</span></span> ‚Üí x(t) = e<sup>Œ±t</sup>(cos Œ≤t, sin Œ≤t)</div>
      <p>‚Üí <strong>Foci</strong> (spirals) or <strong>Centers</strong> (closed orbits)</p></div>
    <h3 style="font-family:'Fraunces',serif;font-size:1.2rem;color:var(--cyan);margin:24px 0 12px;">Classification Summary</h3>
    <table class="tbl"><tr><th>Eigenvalues</th><th>Portrait Type</th><th>Stability</th></tr>
      <tr><td>Œª‚ÇÅ, Œª‚ÇÇ real, same sign</td><td>Node</td><td>Stable if both &lt; 0</td></tr>
      <tr><td>Œª‚ÇÅ, Œª‚ÇÇ real, opposite</td><td>Saddle</td><td>Always unstable</td></tr>
      <tr><td>Œª repeated (defective)</td><td>Improper node</td><td>Stable if Œ± &lt; 0</td></tr>
      <tr><td>Œ± ¬± Œ≤i, Œ± ‚â† 0</td><td>Focus (spiral)</td><td>Stable if Œ± &lt; 0</td></tr>
      <tr><td>¬± Œ≤i (pure imag.)</td><td>Center</td><td>Stable (not asymp.)</td></tr></table>
    <div class="callout callout-purple"><span class="icon">üîë</span> <strong>Key insight:</strong> trace = Œª‚ÇÅ+Œª‚ÇÇ, det = Œª‚ÇÅŒª‚ÇÇ, discriminant Œî = tr¬≤‚àí4det. These three numbers classify everything.</div>
  </div>`;
};

builders.case1=()=>{
  document.getElementById("tab-case1").innerHTML=`<div class="split">
  <div class="theory">
    <h2>Case 1: Diagonal Matrix</h2>
    <p>When A has two real, distinct eigenvalues:</p>
    <div class="math-block"><span class="tag">Canonical Form</span>M = <span class="mtx"><span>Œ±</span><span>0</span><span>0</span><span>Œ≤</span></span> &nbsp;‚Üí&nbsp; x‚ÇÅ(t) = c‚ÇÅe<sup>Œ±t</sup>, &nbsp; x‚ÇÇ(t) = c‚ÇÇe<sup>Œ≤t</sup></div>
    <h3>The Power-Law Trick</h3>
    <p>Eliminate time: since x‚ÇÅ<sup>Œ≤</sup> = c‚ÇÅ<sup>Œ≤</sup>e<sup>Œ±Œ≤t</sup> and x‚ÇÇ<sup>Œ±</sup> = c‚ÇÇ<sup>Œ±</sup>e<sup>Œ±Œ≤t</sup>, we get:</p>
    <div class="math-block"><span class="tag">Trajectory Shape</span>x‚ÇÇ = C ¬∑ x‚ÇÅ<sup>Œ≤/Œ±</sup> &nbsp; (power-law curves)</div>
    <div class="callout callout-blue"><span class="icon">üí°</span> The ratio <strong>Œ≤/Œ±</strong> determines the curve shape: Œ≤/Œ± = 1 ‚Üí straight lines (star), Œ≤/Œ± ‚â† 1 ‚Üí power curves, Œ≤/Œ± &lt; 0 ‚Üí hyperbolas (saddle).</div>
    <h3>Sub-cases</h3>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">Œ±,Œ≤ &gt; 0</span> Unstable Node</div>
      <p>Both grow ‚Üí trajectories <strong>flee origin</strong>. At large times, fast mode dominates ‚Üí tangent to fast eigenvector.</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-stable">Œ±,Œ≤ &lt; 0</span> Stable Node</div>
      <p>Both decay ‚Üí trajectories <strong>converge to origin</strong>. Late times: slow mode dominates ‚Üí tangent to slow eigenvector. <em>Think: overdamped door closer.</em></p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">Œ±Œ≤ &lt; 0</span> Saddle</div>
      <p>One grows, one decays. <span style="color:var(--green)">Stable separatrix</span> (Œª&lt;0) attracts, <span style="color:var(--red)">unstable separatrix</span> (Œª&gt;0) repels. Only trajectories exactly on the stable direction reach origin.</p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-neutral">Œ± = Œ≤</span> Star Node</div>
      <p>Equal eigenvalues + diagonalizable ‚Üí every direction is an eigenvector ‚Üí perfect radial star pattern.</p></div>
    <div class="callout callout-green"><span class="icon">üîë</span> For general A, the portrait is <strong>skewed</strong> ‚Äî axes align with eigenvectors instead of x‚ÇÅ,x‚ÇÇ.</div>
  </div>
  <div class="viz">
    <div class="pills" id="c1pills"></div>
    <div class="card">
      <div class="card-head"><span>Phase Portrait</span><span class="badge" id="c1cls"></span></div>
      <canvas id="c1c" style="height:clamp(280px, 36vh, 440px);"></canvas>
      <div class="ctrl-bar">
        <div class="ctrl"><label>Œ±</label><input type="range" id="c1a" min="-3" max="3" step=".1" value="1"/><span class="v" id="c1av">1</span></div>
        <div class="ctrl"><label>Œ≤</label><input type="range" id="c1b" min="-3" max="3" step=".1" value=".5"/><span class="v" id="c1bv">.5</span></div>
      </div>
      <div class="ctrl-bar">
        <button class="btn btn-primary" id="c1p">‚ñ∂ Play</button><button class="btn" id="c1r">‚ü≤</button>
        <div class="ctrl"><label>Speed</label><input type="range" id="c1sp" min=".1" max="2" step=".1" value=".8"/></div>
      </div>
    </div>
    <div class="card">
      <div class="card-head"><span>Time Series</span>${TS_LEGEND}</div>
      <canvas id="c1t" style="height:clamp(90px, 12vh, 150px);"></canvas>
      <div class="time-bar"><input type="range" id="c1tm" min="0" max="1" step=".001" value="0"/></div>
    </div>
  </div></div>`;
  const E=PhaseEngine("c1c","c1t");engines.c1=E;
  const aS=document.getElementById("c1a"),bS=document.getElementById("c1b"),aV=document.getElementById("c1av"),bV=document.getElementById("c1bv"),cls=document.getElementById("c1cls");
  function upd(){const a=+aS.value,b=+bS.value;aV.textContent=a;bV.textContent=b;
    E.setA([[a,0],[0,b]]);cls.textContent=a>0&&b>0?"Unstable Node":a<0&&b<0?"Stable Node":a*b<0?"Saddle":"Star / Borderline";
    E.autoSeed();document.getElementById("c1tm").max=E.S.traj[0]?.tmax||1;}
  [["Unstable Node",1,.5],["Stable Node",-1,-.5],["Saddle",1,-.8],["Star",-1,-1],["Fast/Slow",-.3,-2]].forEach(p=>{
    const b=document.createElement("button");b.className="pill";b.textContent=p[0];
    b.onclick=()=>{aS.value=p[1];bS.value=p[2];upd();};document.getElementById("c1pills").appendChild(b);});
  aS.oninput=bS.oninput=upd;wireControls(E,"c1p","c1r","c1tm","c1sp");upd();E.start();
};

builders.case2=()=>{
  document.getElementById("tab-case2").innerHTML=`<div class="split">
  <div class="theory">
    <h2>Case 2: Repeated Eigenvalue</h2>
    <p>When A has a repeated eigenvalue Œ± but is <em>not</em> diagonalizable:</p>
    <div class="math-block"><span class="tag">Canonical Form</span>M = <span class="mtx"><span>Œ±</span><span>1</span><span>0</span><span>Œ±</span></span> = Œ±I + N, &nbsp; where N¬≤ = 0</div>
    <h3>The D + N Decomposition</h3>
    <p>Split M into diagonal D = Œ±I and nilpotent N. Since they commute:</p>
    <div class="math-block"><span class="tag">Matrix Exponential</span>e<sup>tM</sup> = e<sup>Œ±t</sup>(I + tN) = <span class="mtx"><span>e<sup>Œ±t</sup></span><span>te<sup>Œ±t</sup></span><span>0</span><span>e<sup>Œ±t</sup></span></span></div>
    <div class="callout callout-amber"><span class="icon">‚ö†Ô∏è</span> The <strong>te<sup>Œ±t</sup></strong> term from the nilpotent part creates the characteristic "fan" pattern ‚Äî the hallmark of an improper node.</div>
    <h3>General Solution</h3>
    <div class="math-block"><span class="tag">Solution</span>x‚ÇÅ(t) = (c‚ÇÅ + c‚ÇÇt)e<sup>Œ±t</sup>, &nbsp; x‚ÇÇ(t) = c‚ÇÇe<sup>Œ±t</sup></div>
    <p>‚Ä¢ If c‚ÇÇ = 0 ‚Üí lies on x‚ÇÅ-axis (the single separatrix)</p>
    <p>‚Ä¢ If c‚ÇÇ ‚â† 0 ‚Üí polynomial √ó exponential creates the fan shape</p>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-stable">Œ± &lt; 0</span> Stable Improper Node</div>
      <p>Fan converges toward x‚ÇÅ-axis. <em>Physical analogy: critically damped suspension.</em></p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">Œ± &gt; 0</span> Unstable Improper Node</div>
      <p>Fan expands outward from origin along x‚ÇÅ-axis.</p></div>
    <div class="callout callout-purple"><span class="icon">üîë</span> This sits exactly on <strong>Œî = 0</strong> (the parabola in trace-det space). Perturb slightly ‚Üí node (Œî&gt;0) or focus (Œî&lt;0). Try the slider!</div>
  </div>
  <div class="viz">
    <div class="card">
      <div class="card-head"><span>Phase Portrait</span><span class="badge" id="c2cls"></span></div>
      <canvas id="c2c" style="height:clamp(280px, 36vh, 440px);"></canvas>
      <div class="ctrl-bar">
        <div class="ctrl"><label>Œ±</label><input type="range" id="c2a" min="-3" max="3" step=".1" value="-1"/><span class="v" id="c2av">-1</span></div>
      </div>
      <div class="ctrl-bar"><button class="btn btn-primary" id="c2p">‚ñ∂ Play</button><button class="btn" id="c2r">‚ü≤</button>
        <div class="ctrl"><label>Speed</label><input type="range" id="c2sp" min=".1" max="2" step=".1" value=".8"/></div></div>
    </div>
    <div class="card">
      <div class="card-head"><span>Time Series</span>${TS_LEGEND}</div>
      <canvas id="c2t" style="height:clamp(90px, 12vh, 150px);"></canvas>
      <div class="time-bar"><input type="range" id="c2tm" min="0" max="1" step=".001" value="0"/></div>
    </div>
  </div></div>`;
  const E=PhaseEngine("c2c","c2t");engines.c2=E;
  const aS=document.getElementById("c2a"),aV=document.getElementById("c2av"),cls=document.getElementById("c2cls");
  function upd(){const a=+aS.value;aV.textContent=a;E.setA([[a,1],[0,a]]);
    cls.textContent=a<0?"Stable Improper Node":a>0?"Unstable Improper Node":"Degenerate";
    E.autoSeed();document.getElementById("c2tm").max=E.S.traj[0]?.tmax||1;}
  aS.oninput=upd;wireControls(E,"c2p","c2r","c2tm","c2sp");upd();E.start();
};

builders.case3=()=>{
  document.getElementById("tab-case3").innerHTML=`<div class="split">
  <div class="theory">
    <h2>Case 3: Complex Eigenvalues</h2>
    <p>When A has complex eigenvalues Œ± ¬± Œ≤i:</p>
    <div class="math-block"><span class="tag">Canonical Form</span>M = <span class="mtx"><span>Œ±</span><span>‚àíŒ≤</span><span>Œ≤</span><span>Œ±</span></span></div>
    <h3>Matrix Exponential</h3>
    <div class="math-block"><span class="tag">Key Formula</span>e<sup>tM</sup> = e<sup>Œ±t</sup> <span class="mtx"><span>cos Œ≤t</span><span>‚àísin Œ≤t</span><span>sin Œ≤t</span><span>cos Œ≤t</span></span></div>
    <div class="callout callout-blue"><span class="icon">üí°</span> This is a <strong>rotation</strong> (cos/sin matrix) scaled by an <strong>exponential envelope</strong> (e<sup>Œ±t</sup>). Two independent effects!</div>
    <h3>Solution Structure</h3>
    <div class="math-block"><span class="tag">General Solution</span>x‚ÇÅ = e<sup>Œ±t</sup>(c‚ÇÅcos Œ≤t ‚àí c‚ÇÇsin Œ≤t)<br>x‚ÇÇ = e<sup>Œ±t</sup>(c‚ÇÅsin Œ≤t + c‚ÇÇcos Œ≤t)</div>
    <p>‚Ä¢ <strong>Oscillation</strong> from cos/sin ‚Üí period T = 2œÄ/|Œ≤|</p>
    <p>‚Ä¢ <strong>Envelope</strong> from e<sup>Œ±t</sup> ‚Üí growing, decaying, or constant amplitude</p>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-stable">Œ± &lt; 0</span> Stable Focus</div>
      <p>Spiral <strong>inward</strong>. Half-life = ln2/|Œ±|. <em>Damped pendulum.</em></p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-unstable">Œ± &gt; 0</span> Unstable Focus</div>
      <p>Spiral <strong>outward</strong>. Doubling time = ln2/Œ±. <em>Microphone feedback.</em></p></div>
    <div class="subcase"><div class="subcase-title"><span class="badge-s badge-neutral">Œ± = 0</span> Center</div>
      <p><strong>Closed orbits</strong>. No growth/decay. <em>Frictionless pendulum.</em></p></div>
    <div class="callout callout-green"><span class="icon">üîÑ</span> Orientation: <strong>Œ≤ &gt; 0</strong> ‚Üí counter-clockwise, <strong>Œ≤ &lt; 0</strong> ‚Üí clockwise (for canonical form). For general A, check direction at one point.</div>
  </div>
  <div class="viz">
    <div class="pills" id="c3pills"></div>
    <div class="card">
      <div class="card-head"><span>Phase Portrait</span><span class="badge" id="c3cls"></span></div>
      <canvas id="c3c" style="height:clamp(280px, 36vh, 440px);"></canvas>
      <div class="ctrl-bar">
        <div class="ctrl"><label>Œ±</label><input type="range" id="c3a" min="-2" max="2" step=".05" value="0"/><span class="v" id="c3av">0</span></div>
        <div class="ctrl"><label>Œ≤</label><input type="range" id="c3b" min="-3" max="3" step=".1" value="1"/><span class="v" id="c3bv">1</span></div>
      </div>
      <div class="ctrl-bar"><button class="btn btn-primary" id="c3p">‚ñ∂ Play</button><button class="btn" id="c3r">‚ü≤</button>
        <div class="ctrl"><label>Speed</label><input type="range" id="c3sp" min=".1" max="2" step=".1" value=".8"/></div></div>
    </div>
    <div class="card">
      <div class="card-head"><span>Time Series</span>${TS_LEGEND}</div>
      <canvas id="c3t" style="height:clamp(90px, 12vh, 150px);"></canvas>
      <div class="time-bar"><input type="range" id="c3tm" min="0" max="1" step=".001" value="0"/></div>
    </div>
  </div></div>`;
  const E=PhaseEngine("c3c","c3t");engines.c3=E;
  const aS=document.getElementById("c3a"),bS=document.getElementById("c3b"),aV=document.getElementById("c3av"),bV=document.getElementById("c3bv"),cls=document.getElementById("c3cls");
  function upd(){const a=+aS.value,b=+bS.value;aV.textContent=a;bV.textContent=b;
    E.setA([[a,-b],[b,a]]);cls.textContent=Math.abs(a)<.03?"Center":a<0?"Stable Focus":"Unstable Focus";
    E.autoSeed();document.getElementById("c3tm").max=E.S.traj[0]?.tmax||1;}
  [["Center",0,1],["Stable Focus",-.3,1],["Unstable Focus",.3,1],["Fast Spiral",-.5,2],["Clockwise",0,-1]].forEach(p=>{
    const b=document.createElement("button");b.className="pill";b.textContent=p[0];
    b.onclick=()=>{aS.value=p[1];bS.value=p[2];upd();};document.getElementById("c3pills").appendChild(b);});
  aS.oninput=bS.oninput=upd;wireControls(E,"c3p","c3r","c3tm","c3sp");upd();E.start();
};

builders.examples=()=>{
  document.getElementById("tab-examples").innerHTML=`<div class="split">
  <div class="theory">
    <h2>Examples</h2>
    <div class="pills"><button class="pill on" id="ex1b">Example 1 ‚Äî Elliptic Center</button><button class="pill" id="ex2b">Example 2 ‚Äî Skewed Saddle</button></div>
    <div id="ex1t">
      <h3>Elliptic Center</h3>
      <div class="math-block"><span class="tag">System</span>x‚Ä≤ = Ax, &nbsp; A = <span class="mtx"><span>0</span><span>‚àí4</span><span>1</span><span>0</span></span></div>
      <div class="steps">
        <div class="step"><h4>Eigenvalues</h4><p>Œª¬≤ + 4 = 0 ‚Üí <strong>Œª = ¬±2i</strong> (pure imaginary ‚Üí center)</p></div>
        <div class="step"><h4>Real Canonical Form</h4><p>Eigenvector for Œª=2i: w = w‚ÇÇ(2i, 1)·µÄ. Split: Re=(0,1), Im=(2,0).</p>
          <p>P = <span class="mtx"><span>2</span><span>0</span><span>0</span><span>1</span></span>, &nbsp; M = P‚Åª¬πAP = <span class="mtx"><span>0</span><span>‚àí2</span><span>2</span><span>0</span></span></p></div>
        <div class="step"><h4>Solution</h4><div class="math-block">e<sup>tA</sup> = <span class="mtx"><span>cos 2t</span><span>‚àí2sin 2t</span><span>¬Ωsin 2t</span><span>cos 2t</span></span></div></div>
        <div class="step"><h4>Trajectory Shape</h4>
          <p>Eliminate t: <strong>x‚ÇÅ¬≤ + 4x‚ÇÇ¬≤ = constant</strong> ‚Üí ellipses!</p>
          <div class="callout callout-blue"><span class="icon">üí°</span> P "skews" canonical circles into ellipses. The x‚ÇÇ-axis is compressed by factor ¬Ω.</div></div>
        <div class="step"><h4>Orientation</h4><p>At (1,0): A¬∑(1,0)·µÄ = (0,1)·µÄ ‚Üí upward ‚Üí <strong>counter-clockwise</strong>.</p></div>
      </div>
    </div>
    <div id="ex2t" style="display:none;">
      <h3>Skewed Saddle</h3>
      <div class="math-block"><span class="tag">System</span>x‚Ä≤ = Ax, &nbsp; A = <span class="mtx"><span>2</span><span>‚àí3</span><span>1</span><span>‚àí2</span></span></div>
      <div class="steps">
        <div class="step"><h4>Eigenvalues</h4><p>Œª¬≤ ‚àí 1 = 0 ‚Üí <strong>Œª = +1 and ‚àí1</strong> (opposite signs ‚Üí saddle)</p></div>
        <div class="step"><h4>Eigenvectors</h4>
          <p>Œª=1: v‚ÇÅ = <strong>(3, 1)·µÄ</strong> &nbsp;&nbsp; Œª=‚àí1: v‚ÇÇ = <strong>(1, 1)·µÄ</strong></p></div>
        <div class="step"><h4>General Solution</h4>
          <div class="math-block">x(t) = c‚ÇÅe<sup>t</sup><span class="mtx"><span>3</span><span>1</span></span> + c‚ÇÇe<sup>‚àít</sup><span class="mtx"><span>1</span><span>1</span></span></div></div>
        <div class="step"><h4>Separatrices</h4>
          <p>c‚ÇÅ=0: along <strong>v‚ÇÇ=(1,1)</strong>, slope 1 ‚Üí <span style="color:var(--green)">approaches origin</span> (Œª=‚àí1)</p>
          <p>c‚ÇÇ=0: along <strong>v‚ÇÅ=(3,1)</strong>, slope ‚Öì ‚Üí <span style="color:var(--red)">escapes origin</span> (Œª=+1)</p>
          <div class="callout callout-amber"><span class="icon">‚öîÔ∏è</span> The eigenvector lines are <strong>separatrices</strong>. They divide the plane into 4 regions with characteristic hyperbolic flow. This is the canonical saddle "skewed" by P.</div></div>
      </div>
    </div>
  </div>
  <div class="viz">
    <div class="card">
      <div class="card-head"><span>Phase Portrait</span><span class="badge" id="excls"></span></div>
      <canvas id="exc" style="height:clamp(300px, 40vh, 480px);"></canvas>
      <div class="ctrl-bar"><button class="btn btn-primary" id="exp">‚ñ∂ Play</button><button class="btn" id="exr">‚ü≤</button>
        <div class="ctrl"><label>Speed</label><input type="range" id="exsp" min=".1" max="2" step=".1" value=".8"/></div></div>
    </div>
    <div class="card">
      <div class="card-head"><span>Time Series</span>${TS_LEGEND}</div>
      <canvas id="ext" style="height:clamp(90px, 12vh, 150px);"></canvas>
      <div class="time-bar"><input type="range" id="extm" min="0" max="1" step=".001" value="0"/></div>
    </div>
  </div></div>`;
  const E=PhaseEngine("exc","ext");engines.ex=E;
  const cls=document.getElementById("excls"),e1b=document.getElementById("ex1b"),e2b=document.getElementById("ex2b"),e1t=document.getElementById("ex1t"),e2t=document.getElementById("ex2t");
  function loadEx1(){E.setA([[0,-4],[1,0]]);cls.textContent="Center (elliptic)";E.clear();
    [[1,0],[2.5,0],[4,0],[0,.4],[0,.9],[0,1.6]].forEach(p=>E.add(p));
    document.getElementById("extm").max=E.S.traj[0]?.tmax||1;E.S.t=0;
    e1t.style.display="block";e2t.style.display="none";e1b.classList.add("on");e2b.classList.remove("on");}
  function loadEx2(){E.setA([[2,-3],[1,-2]]);cls.textContent="Saddle";E.clear();
    [[2,.8],[2,-.8],[-2,.8],[-2,-.8],[1.5,1.3],[-1.5,-1.3],[1.5,-1.3],[-1.5,1.3]].forEach(p=>E.add(p));
    document.getElementById("extm").max=E.S.traj[0]?.tmax||1;E.S.t=0;
    e1t.style.display="none";e2t.style.display="block";e1b.classList.remove("on");e2b.classList.add("on");}
  e1b.onclick=loadEx1;e2b.onclick=loadEx2;
  wireControls(E,"exp","exr","extm","exsp");loadEx1();E.start();
};

builders.explorer=()=>{
  document.getElementById("tab-explorer").innerHTML=`<div class="split">
  <div class="theory" style="gap:0;">
    <h2>Free Explorer</h2>
    <p>Enter any 2√ó2 matrix. Click the phase plane to add trajectories.</p>
    <div class="grid2x2" style="margin:8px 0;">
      <input id="fa11" type="number" step=".1" value="0"/><input id="fa12" type="number" step=".1" value="-1"/>
      <input id="fa21" type="number" step=".1" value="1"/><input id="fa22" type="number" step=".1" value="0"/>
    </div>
    <div class="eigbox">
      <div class="kv"><span>trace</span><b id="ftr">‚Äî</b></div>
      <div class="kv"><span>det</span><b id="fdet">‚Äî</b></div>
      <div class="kv"><span>Œî = tr¬≤‚àí4det</span><b id="fdisc">‚Äî</b></div>
      <hr class="kv-sep"/>
      <div class="kv"><span>Œª‚ÇÅ</span><b id="fl1">‚Äî</b></div>
      <div class="kv"><span>Œª‚ÇÇ</span><b id="fl2">‚Äî</b></div>
      <div class="kv" id="fevecs"></div>
      <div class="kv" id="fmode"></div>
    </div>
    <div style="margin-top:10px;">
      <div style="font-size:.75rem;color:var(--txt3);font-weight:600;">Sliders</div>
      <div style="display:grid;grid-template-columns:30px 1fr;gap:2px 6px;align-items:center;font-size:.75rem;margin-top:4px;">
        <span class="mono" style="color:var(--txt3)">a‚ÇÅ‚ÇÅ</span><input id="fs11" type="range" min="-5" max="5" step=".05" style="width:100%;accent-color:var(--cyan);"/>
        <span class="mono" style="color:var(--txt3)">a‚ÇÅ‚ÇÇ</span><input id="fs12" type="range" min="-5" max="5" step=".05" style="width:100%;accent-color:var(--cyan);"/>
        <span class="mono" style="color:var(--txt3)">a‚ÇÇ‚ÇÅ</span><input id="fs21" type="range" min="-5" max="5" step=".05" style="width:100%;accent-color:var(--cyan);"/>
        <span class="mono" style="color:var(--txt3)">a‚ÇÇ‚ÇÇ</span><input id="fs22" type="range" min="-5" max="5" step=".05" style="width:100%;accent-color:var(--cyan);"/>
      </div>
    </div>
    <h3 style="margin-top:14px;">Presets</h3>
    <div class="pills" id="fpills"></div>
    <div class="callout callout-blue" id="finsight" style="margin-top:10px;"></div>
    <h3 style="margin-top:16px;">Trace‚ÄìDeterminant Classification Map</h3>
    <p style="font-size:.82rem;color:var(--txt2);margin-bottom:8px;">Every 2√ó2 matrix maps to a point (tr&thinsp;A, det&thinsp;A). The <strong>parabola</strong> Œî = tr¬≤ ‚àí 4¬∑det = 0 separates real eigenvalues (below) from complex (above). <strong>det &lt; 0</strong> ‚Üí saddle. The blue dot shows your current matrix.</p>
    <div style="margin-top:8px;"><canvas id="ftd" style="width:100%;height:clamp(200px, 22vh, 320px);border-radius:var(--radius);border:1px solid var(--border);"></canvas></div>
  </div>
  <div class="viz">
    <div class="card">
      <div class="card-head"><span>Phase Portrait</span><span class="badge" id="fcls"></span></div>
      <canvas id="fc" style="height:clamp(300px, 42vh, 520px);"></canvas>
      <div class="ctrl-bar">
        <button class="btn btn-primary" id="fp">‚ñ∂ Play</button><button class="btn" id="fr">‚ü≤</button>
        <button class="btn btn-danger" id="fcl">Clear</button>
        <div class="ctrl"><label>Speed</label><input type="range" id="fsp" min=".1" max="2" step=".1" value=".8"/></div>
      </div>
    </div>
    <div class="card">
      <div class="card-head"><span>Time Series</span>${TS_LEGEND}</div>
      <canvas id="ft" style="height:clamp(100px, 14vh, 160px);"></canvas>
      <div class="time-bar"><input type="range" id="ftm" min="0" max="1" step=".001" value="0"/></div>
    </div>
  </div></div>`;
  const $=id=>document.getElementById(id);
  const E=PhaseEngine("fc","ft");engines.free=E;
  const ins={a11:$("fa11"),a12:$("fa12"),a21:$("fa21"),a22:$("fa22")};
  const sls={s11:$("fs11"),s12:$("fs12"),s21:$("fs21"),s22:$("fs22")};
  const PRESETS=[{l:"Center",A:[[0,-1],[1,0]]},{l:"Stable Focus",A:[[-0.3,-1],[1,-0.3]]},
    {l:"Unstable Focus",A:[[0.3,-1],[1,0.3]]},{l:"Stable Node",A:[[-1,0],[0,-2]]},
    {l:"Unstable Node",A:[[1,0],[0,2]]},{l:"Saddle",A:[[1,0],[0,-1]]},
    {l:"Improper",A:[[-1,1],[0,-1]]},{l:"Ex 1",A:[[0,-4],[1,0]]},{l:"Ex 2",A:[[2,-3],[1,-2]]}];
  const INSIGHTS={center:"üîÑ <strong>Center:</strong> Pure imaginary eigenvalues. Closed orbits ‚Äî no growth or decay.",
    stable_focus:"üåÄ <strong>Stable Focus:</strong> Complex Œª with Re &lt; 0. Spirals inward ‚Äî oscillation + decay.",
    unstable_focus:"üí• <strong>Unstable Focus:</strong> Complex Œª with Re &gt; 0. Spirals outward ‚Äî oscillation + growth.",
    stable_node:"üéØ <strong>Stable Node:</strong> Both Œª real &amp; negative. All paths converge tangent to slow eigenvector.",
    unstable_node:"üöÄ <strong>Unstable Node:</strong> Both Œª real &amp; positive. Everything escapes along fast eigenvector.",
    saddle:"‚öîÔ∏è <strong>Saddle:</strong> Œª of opposite sign. Stable &amp; unstable separatrices create hyperbolic flow.",
    degenerate:"üî∂ <strong>Degenerate:</strong> Repeated Œª. The te<sup>Œªt</sup> term creates a fan pattern."};
  PRESETS.forEach(p=>{const b=document.createElement("button");b.className="pill";b.textContent=p.l;
    b.onclick=()=>{ins.a11.value=p.A[0][0];ins.a12.value=p.A[0][1];ins.a21.value=p.A[1][0];ins.a22.value=p.A[1][1];
      sls.s11.value=p.A[0][0];sls.s12.value=p.A[0][1];sls.s21.value=p.A[1][0];sls.s22.value=p.A[1][1];upd(true);};
    $("fpills").appendChild(b);});
  function upd(autoS=false){
    const A=[[+ins.a11.value,+ins.a12.value],[+ins.a21.value,+ins.a22.value]];
    E.setA(A);sls.s11.value=A[0][0];sls.s12.value=A[0][1];sls.s21.value=A[1][0];sls.s22.value=A[1][1];
    const eig=eig2x2(A),cls=classifyKey(eig);
    $("ftr").textContent=fmt(eig.tr);$("fdet").textContent=fmt(eig.det);$("fdisc").textContent=fmt(eig.disc);
    $("fl1").textContent=cfmt(eig.l1.re,eig.l1.im);$("fl2").textContent=cfmt(eig.l2.re,eig.l2.im);
    $("fcls").textContent=CLASS_NAMES[cls]||"";$("finsight").innerHTML=INSIGHTS[cls]||"";
    if(eig.evecs.length>0){const v1=eig.evecs[0],v2=eig.evecs[1];
      $("fevecs").innerHTML=v2?`<span>eigenvec</span><b>[${fmt(v1[0])},${fmt(v1[1])}] [${fmt(v2[0])},${fmt(v2[1])}]</b>`
        :`<span>eigenvec</span><b>[${fmt(v1[0])},${fmt(v1[1])}]</b>`;}
    else $("fevecs").innerHTML=`<span>eigenvec</span><b>(complex)</b>`;
    let mode="";if(Math.abs(eig.l1.im)>1e-8){const a=eig.l1.re,w=Math.abs(eig.l1.im),T=2*Math.PI/w;
      mode=Math.abs(a)<1e-8?`T‚âà${fmt(T)}`:a<0?`t¬Ω‚âà${fmt(Math.log(2)/Math.abs(a))}, T‚âà${fmt(T)}`:`t‚ÇÇ‚âà${fmt(Math.log(2)/Math.abs(a))}, T‚âà${fmt(T)}`;}
    else{const l=[eig.l1.re,eig.l2.re].map(Math.abs).sort();mode=`œÑ_slow‚âà${fmt(l[0]>1e-8?1/l[0]:Infinity)}, œÑ_fast‚âà${fmt(l[1]>1e-8?1/l[1]:Infinity)}`;}
    $("fmode").innerHTML=`<span>dynamics</span><b>${mode}</b>`;
    if(autoS)E.autoSeed();
    $("ftm").max=E.S.traj[0]?.tmax||1;drawTD();
  }
  function drawTD(){
    const c=$("ftd");if(!c)return;const d=devicePixelRatio||1,r=c.getBoundingClientRect();
    c.width=Math.floor(r.width*d);c.height=Math.floor(r.height*d);
    const ctx=c.getContext("2d"),w=c.width,h=c.height;
    ctx.fillStyle="#0c0f1a";ctx.fillRect(0,0,w,h);
    // Padding for axis labels
    const padL=42*d,padR=14*d,padT=14*d,padB=28*d;
    const pw=w-padL-padR,ph=h-padT-padB;
    const trMax=7,detMin=-7,detMax=12;
    const xP=t=>padL+((t+trMax)/(2*trMax))*pw;
    const yP=det=>padT+(1-(det-detMin)/(detMax-detMin))*ph;
    // Region fills ‚Äî saddle below det=0
    ctx.fillStyle="rgba(248,113,113,.06)";
    ctx.fillRect(padL,yP(0),pw,yP(detMin)-yP(0));
    // Stable/unstable node & focus regions
    function fillRegion(sideSign,aboveParabola,color){
      ctx.save();ctx.fillStyle=color;ctx.beginPath();
      const ts=sideSign<0?-trMax:0,te=sideSign<0?0:trMax;
      if(aboveParabola){
        for(let i=0;i<=200;i++){const t=ts+(te-ts)*(i/200),px=xP(t),py=yP((t*t)/4);i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);}
        ctx.lineTo(xP(te),yP(detMax));ctx.lineTo(xP(ts),yP(detMax));
      }else{
        ctx.moveTo(xP(ts),yP(0));ctx.lineTo(xP(te),yP(0));
        for(let i=200;i>=0;i--){const t=ts+(te-ts)*(i/200);ctx.lineTo(xP(t),yP((t*t)/4));}
      }
      ctx.closePath();ctx.fill();ctx.restore();
    }
    fillRegion(-1,0,"rgba(52,211,153,.08)");  // stable node
    fillRegion(-1,1,"rgba(52,211,153,.05)");  // stable focus
    fillRegion(1,0,"rgba(248,113,113,.08)");  // unstable node
    fillRegion(1,1,"rgba(248,113,113,.05)");  // unstable focus
    // Axes
    ctx.strokeStyle="rgba(255,255,255,.12)";ctx.lineWidth=1;ctx.beginPath();
    ctx.moveTo(xP(-trMax),yP(0));ctx.lineTo(xP(trMax),yP(0));ctx.stroke();
    ctx.beginPath();ctx.moveTo(xP(0),yP(detMin));ctx.lineTo(xP(0),yP(detMax));ctx.stroke();
    // Tick marks
    ctx.fillStyle="rgba(255,255,255,.3)";ctx.font=`${9*d}px Outfit`;ctx.textAlign="center";
    for(let t=-6;t<=6;t+=2){if(t===0)continue;ctx.fillText(t.toString(),xP(t),yP(detMin)+14*d);}
    ctx.textAlign="right";ctx.textBaseline="middle";
    for(let det=-4;det<=10;det+=4){if(det===0)continue;ctx.fillText(det.toString(),padL-6*d,yP(det));}
    // Axis labels
    ctx.fillStyle="rgba(255,255,255,.45)";ctx.font=`600 ${10*d}px Outfit`;
    ctx.textAlign="center";ctx.textBaseline="top";
    ctx.fillText("tr(A)",xP(0),yP(detMin)+16*d);
    ctx.save();ctx.translate(12*d,yP((detMax+detMin)/2));ctx.rotate(-Math.PI/2);
    ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("det(A)",0,0);ctx.restore();
    // Parabola Œî=0
    ctx.strokeStyle="rgba(251,191,36,.5)";ctx.lineWidth=1.5;ctx.beginPath();
    for(let i=0;i<=200;i++){const t=-trMax+(2*trMax)*(i/200),px=xP(t),py=yP((t*t)/4);
      i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);}ctx.stroke();
    // Parabola label
    ctx.save();ctx.fillStyle="rgba(251,191,36,.6)";ctx.font=`500 ${9*d}px 'JetBrains Mono',monospace`;
    ctx.textAlign="left";ctx.fillText("Œî = 0",xP(3.8),yP(3.8*3.8/4)-6*d);ctx.restore();
    // Region labels
    ctx.font=`600 ${9.5*d}px Outfit`;ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillStyle="rgba(52,211,153,.45)";
    ctx.fillText("Stable Node",xP(-3.5),yP(2));
    ctx.fillText("Stable Focus",xP(-3),yP(7));
    ctx.fillStyle="rgba(248,113,113,.45)";
    ctx.fillText("Unstable Node",xP(3.5),yP(2));
    ctx.fillText("Unstable Focus",xP(3),yP(7));
    ctx.fillStyle="rgba(248,113,113,.3)";
    ctx.fillText("Saddle",xP(0),yP(-3.5));
    // Center label on the det axis (tr=0, above parabola)
    ctx.fillStyle="rgba(251,191,36,.45)";ctx.font=`600 ${8.5*d}px Outfit`;
    ctx.fillText("Centers",xP(0),yP(6));
    // det=0 line label
    ctx.fillStyle="rgba(255,255,255,.2)";ctx.font=`${8*d}px Outfit`;
    ctx.fillText("det = 0",xP(5.5),yP(0)-6*d);
    // Current matrix dot
    const eig=eig2x2(E.S.A);
    const dotX=xP(clamp(eig.tr,-trMax,trMax)),dotY=yP(clamp(eig.det,detMin,detMax));
    // Glow
    ctx.save();const grd=ctx.createRadialGradient(dotX,dotY,0,dotX,dotY,14*d);
    grd.addColorStop(0,"rgba(77,142,255,.3)");grd.addColorStop(1,"transparent");
    ctx.fillStyle=grd;ctx.beginPath();ctx.arc(dotX,dotY,14*d,0,Math.PI*2);ctx.fill();ctx.restore();
    // Dot
    ctx.fillStyle="#4d8eff";ctx.beginPath();ctx.arc(dotX,dotY,5*d,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle="rgba(255,255,255,.4)";ctx.lineWidth=1.5;ctx.stroke();
  }
  for(const k in ins)ins[k].addEventListener("input",()=>{sls["s"+k.slice(1)].value=ins[k].value;upd(true);});
  for(const k in sls)sls[k].addEventListener("input",()=>{ins["a"+k.slice(1)].value=sls[k].value;upd(true);});
  wireControls(E,"fp","fr","ftm","fsp","fcl");upd(true);E.start();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
initTabs();
// Overview is pre-rendered in HTML for SEO; mark as built, skip re-render
built.overview=true;
builders.case1();built.case1=true;
</script>
</body>
</html>
